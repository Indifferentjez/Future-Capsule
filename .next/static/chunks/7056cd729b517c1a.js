(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70065,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(47163);let n=s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("div",{ref:n,className:(0,r.cn)("rounded-lg border border-border bg-card text-card-foreground shadow-sm",e),...s}));n.displayName="Card";let i=s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("div",{ref:n,className:(0,r.cn)("flex flex-col space-y-1.5 p-6",e),...s}));i.displayName="CardHeader";let o=s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("h3",{ref:n,className:(0,r.cn)("font-semibold leading-none tracking-tight",e),...s}));o.displayName="CardTitle";let l=s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("p",{ref:n,className:(0,r.cn)("text-sm text-muted-foreground",e),...s}));l.displayName="CardDescription";let a=s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("div",{ref:n,className:(0,r.cn)("p-6 pt-0",e),...s}));a.displayName="CardContent",s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("div",{ref:n,className:(0,r.cn)("flex items-center p-6 pt-0",e),...s})).displayName="CardFooter",e.s(["Card",()=>n,"CardContent",()=>a,"CardDescription",()=>l,"CardHeader",()=>i,"CardTitle",()=>o])},18566,(e,t,s)=>{t.exports=e.r(76562)},10708,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(47163);let n=s.forwardRef(({className:e,...s},n)=>(0,t.jsx)("label",{ref:n,className:(0,r.cn)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",e),...s}));n.displayName="Label",e.s(["Label",()=>n])},23750,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(47163);let n=s.forwardRef(({className:e,type:s,...n},i)=>(0,t.jsx)("input",{type:s,className:(0,r.cn)("flex h-10 w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:i,...n}));n.displayName="Input",e.s(["Input",()=>n])},75254,e=>{"use strict";var t=e.i(71645);let s=(...e)=>e.filter((e,t,s)=>!!e&&""!==e.trim()&&s.indexOf(e)===t).join(" ").trim();var r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let n=(0,t.forwardRef)(({color:e="currentColor",size:n=24,strokeWidth:i=2,absoluteStrokeWidth:o,className:l="",children:a,iconNode:d,...c},u)=>(0,t.createElement)("svg",{ref:u,...r,width:n,height:n,stroke:e,strokeWidth:o?24*Number(i)/Number(n):i,className:s("lucide",l),...c},[...d.map(([e,s])=>(0,t.createElement)(e,s)),...Array.isArray(a)?a:[a]])),i=(e,r)=>{let i=(0,t.forwardRef)(({className:i,...o},l)=>(0,t.createElement)(n,{ref:l,iconNode:r,className:s(`lucide-${e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,i),...o}));return i.displayName=`${e}`,i};e.s(["default",()=>i],75254)},39639,e=>{"use strict";let t;var s=e.i(71645);let r=e=>{let t,s=new Set,r=(e,r)=>{let n="function"==typeof e?e(t):e;if(!Object.is(n,t)){let e=t;t=(null!=r?r:"object"!=typeof n||null===n)?n:Object.assign({},t,n),s.forEach(s=>s(t,e))}},n=()=>t,i={setState:r,getState:n,getInitialState:()=>o,subscribe:e=>(s.add(e),()=>s.delete(e))},o=t=e(r,n,i);return i},n=e=>{let t=e?r(e):r,n=e=>(function(e,t=e=>e){let r=s.default.useSyncExternalStore(e.subscribe,s.default.useCallback(()=>t(e.getState()),[e,t]),s.default.useCallback(()=>t(e.getInitialState()),[e,t]));return s.default.useDebugValue(r),r})(t,e);return Object.assign(n,t),n},i={preset:void 0,deliverMode:void 0,deliverAt:void 0,birthdayDay:void 0,birthdayMonth:void 0,timezone:void 0,messageType:void 0,guidedMode:!0,selectedPromptIds:[],textContent:void 0,mediaBlob:null,mediaPath:null,songTitle:null,songArtist:null,songUrl:null,editMessageId:null},o=(t=e=>({...i,setDraft:t=>e(e=>({...e,...t})),reset:()=>e(i)}))?n(t):n;e.s(["useComposeStore",0,o],39639)},88653,e=>{"use strict";e.i(47167);var t=e.i(43476),s=e.i(71645),r=e.i(31178),n=e.i(47414),i=e.i(21476),o=s,l=e.i(37806);class a extends o.Component{getSnapshotBeforeUpdate(e){let t=this.props.childRef.current;if(t&&e.isPresent&&!this.props.isPresent){let e=this.props.sizeRef.current;e.height=t.offsetHeight||0,e.width=t.offsetWidth||0,e.top=t.offsetTop,e.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function d({children:e,isPresent:s}){let r=(0,o.useId)(),n=(0,o.useRef)(null),i=(0,o.useRef)({width:0,height:0,top:0,left:0}),{nonce:d}=(0,o.useContext)(l.MotionConfigContext);return(0,o.useInsertionEffect)(()=>{let{width:e,height:t,top:o,left:l}=i.current;if(s||!n.current||!e||!t)return;n.current.dataset.motionPopId=r;let a=document.createElement("style");return d&&(a.nonce=d),document.head.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${e}px !important;
            height: ${t}px !important;
            top: ${o}px !important;
            left: ${l}px !important;
          }
        `),()=>{document.head.removeChild(a)}},[s]),(0,t.jsx)(a,{isPresent:s,childRef:n,sizeRef:i,children:o.cloneElement(e,{ref:n})})}let c=({children:e,initial:r,isPresent:o,onExitComplete:l,custom:a,presenceAffectsLayout:c,mode:m})=>{let p=(0,n.useConstant)(u),h=(0,s.useId)(),x=(0,s.useCallback)(e=>{for(let t of(p.set(e,!0),p.values()))if(!t)return;l&&l()},[p,l]),g=(0,s.useMemo)(()=>({id:h,initial:r,isPresent:o,custom:a,onExitComplete:x,register:e=>(p.set(e,!1),()=>p.delete(e))}),c?[Math.random(),x]:[o,x]);return(0,s.useMemo)(()=>{p.forEach((e,t)=>p.set(t,!1))},[o]),s.useEffect(()=>{o||p.size||!l||l()},[o]),"popLayout"===m&&(e=(0,t.jsx)(d,{isPresent:o,children:e})),(0,t.jsx)(i.PresenceContext.Provider,{value:g,children:e})};function u(){return new Map}var m=e.i(64978);let p=e=>e.key||"";function h(e){let t=[];return s.Children.forEach(e,e=>{(0,s.isValidElement)(e)&&t.push(e)}),t}var x=e.i(74008);let g=({children:e,custom:i,initial:o=!0,onExitComplete:l,presenceAffectsLayout:a=!0,mode:d="sync",propagate:u=!1})=>{let[g,f]=(0,m.usePresence)(u),y=(0,s.useMemo)(()=>h(e),[e]),b=u&&!g?[]:y.map(p),v=(0,s.useRef)(!0),j=(0,s.useRef)(y),C=(0,n.useConstant)(()=>new Map),[N,w]=(0,s.useState)(y),[S,k]=(0,s.useState)(y);(0,x.useIsomorphicLayoutEffect)(()=>{v.current=!1,j.current=y;for(let e=0;e<S.length;e++){let t=p(S[e]);b.includes(t)?C.delete(t):!0!==C.get(t)&&C.set(t,!1)}},[S,b.length,b.join("-")]);let M=[];if(y!==N){let e=[...y];for(let t=0;t<S.length;t++){let s=S[t],r=p(s);b.includes(r)||(e.splice(t,0,s),M.push(s))}"wait"===d&&M.length&&(e=M),k(h(e)),w(y);return}let{forceRender:R}=(0,s.useContext)(r.LayoutGroupContext);return(0,t.jsx)(t.Fragment,{children:S.map(e=>{let s=p(e),r=(!u||!!g)&&(y===S||b.includes(s));return(0,t.jsx)(c,{isPresent:r,initial:(!v.current||!!o)&&void 0,custom:r?void 0:i,presenceAffectsLayout:a,mode:d,onExitComplete:r?void 0:()=>{if(!C.has(s))return;C.set(s,!0);let e=!0;C.forEach(t=>{t||(e=!1)}),e&&(null==R||R(),k(j.current),u&&(null==f||f()),l&&l())},children:e},s)})})};e.s(["AnimatePresence",()=>g],88653)},18304,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(18566),n=e.i(39639),i=e.i(20755),o=e.i(67881),l=e.i(10708),a=e.i(23750),d=e.i(47163);let c=s.forwardRef(({className:e,children:s,...r},n)=>(0,t.jsx)("select",{ref:n,className:(0,d.cn)("flex h-10 w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),...r,children:s}));c.displayName="Select";let u=["January","February","March","April","May","June","July","August","September","October","November","December"];function m({onNext:e}){let s=(0,n.useComposeStore)(e=>e.deliverMode),r=(0,n.useComposeStore)(e=>e.deliverAt),i=(0,n.useComposeStore)(e=>e.birthdayDay),d=(0,n.useComposeStore)(e=>e.birthdayMonth),m=(0,n.useComposeStore)(e=>e.timezone)??Intl.DateTimeFormat().resolvedOptions().timeZone,p=(0,n.useComposeStore)(e=>e.setDraft),h=e=>{if(p({deliverMode:e}),"date"===e&&!r){let e=new Date;e.setFullYear(e.getFullYear()+1),p({deliverAt:e.toISOString().slice(0,16)})}};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{children:"Delivery mode"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(o.Button,{type:"button",variant:"date"===s?"default":"outline",onClick:()=>h("date"),children:"Specific date"}),(0,t.jsx)(o.Button,{type:"button",variant:"birthday"===s?"default":"outline",onClick:()=>h("birthday"),children:"Birthday"})]})]}),"date"===s&&(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"deliverAt",children:"Delivery date & time"}),(0,t.jsx)(a.Input,{id:"deliverAt",type:"datetime-local",value:r?r.slice(0,16):"",onChange:e=>p({deliverAt:e.target.value?new Date(e.target.value).toISOString():void 0}),min:new Date().toISOString().slice(0,16)})]}),"birthday"===s&&(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"bday-month",children:"Month"}),(0,t.jsxs)(c,{id:"bday-month",value:d??"",onChange:e=>p({birthdayMonth:e.target.value?Number(e.target.value):void 0}),children:[(0,t.jsx)("option",{value:"",children:"Select"}),u.map((e,s)=>(0,t.jsx)("option",{value:s+1,children:e},e))]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"bday-day",children:"Day"}),(0,t.jsx)(a.Input,{id:"bday-day",type:"number",min:1,max:31,placeholder:"1–31",value:i??"",onChange:e=>p({birthdayDay:e.target.value?Number(e.target.value):void 0})})]})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"timezone",children:"Timezone"}),(0,t.jsx)(a.Input,{id:"timezone",value:m,onChange:e=>p({timezone:e.target.value}),readOnly:!0,className:"bg-muted"})]}),(0,t.jsx)(o.Button,{type:"button",onClick:e,children:"Next"})]})}var p=e.i(75254);let h=(0,p.default)("Type",[["polyline",{points:"4 7 4 4 20 4 20 7",key:"1nosan"}],["line",{x1:"9",x2:"15",y1:"20",y2:"20",key:"swin9y"}],["line",{x1:"12",x2:"12",y1:"4",y2:"20",key:"1tx1rr"}]]),x=(0,p.default)("Mic",[["path",{d:"M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z",key:"131961"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}]]),g=(0,p.default)("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function f({onNext:e}){let s=(0,n.useComposeStore)(e=>e.messageType),r=(0,n.useComposeStore)(e=>e.setDraft);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"How do you want to send your message?"}),(0,t.jsx)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[{id:"text",label:"Text",icon:h},{id:"audio",label:"Audio (max 2:00)",icon:x},{id:"video",label:"Video (max 1:30)",icon:g}].map(({id:e,label:n,icon:i})=>(0,t.jsxs)(o.Button,{type:"button",variant:s===e?"default":"outline",className:"h-auto flex flex-col gap-2 py-6",onClick:()=>r({messageType:e}),children:[(0,t.jsx)(i,{className:"h-8 w-8"}),(0,t.jsx)("span",{children:n})]},e))}),(0,t.jsx)(o.Button,{type:"button",onClick:e,disabled:!s,children:"Next"})]})}let y=s.forwardRef(({className:e,checked:s=!1,onCheckedChange:r,...n},i)=>(0,t.jsx)("button",{type:"button",role:"switch","aria-checked":s,ref:i,className:(0,d.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",s?"bg-foreground":"bg-muted",e),onClick:()=>r?.(!s),...n,children:(0,t.jsx)("span",{className:(0,d.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform",s?"translate-x-5":"translate-x-1")})}));function b({onNext:e}){let s=(0,n.useComposeStore)(e=>e.guidedMode),r=(0,n.useComposeStore)(e=>e.setDraft);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg border border-border p-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(l.Label,{htmlFor:"guided",className:"text-base font-medium",children:"Guided mode"}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground mt-1",children:"Show prompts while recording so you know what to talk about."})]}),(0,t.jsx)(y,{id:"guided",checked:s??!0,onCheckedChange:e=>r({guidedMode:e})})]}),(0,t.jsx)(o.Button,{type:"button",onClick:e,children:"Next"})]})}function v({onNext:e}){let r=(0,n.useComposeStore)(e=>e.guidedMode),l=(0,n.useComposeStore)(e=>e.selectedPromptIds)??[],a=(0,n.useComposeStore)(e=>e.setDraft),[c,u]=(0,s.useState)([]),[m,p]=(0,s.useState)(!0),h=(0,i.createClient)();if((0,s.useEffect)(()=>{h.from("prompts").select("id, category, time_horizon, intensity, text").then(({data:e})=>{u(e??[]),p(!1)})},[h]),!r)return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Guided mode is off. Skip to your message."}),(0,t.jsx)(o.Button,{type:"button",onClick:e,children:"Next"})]});if(m)return(0,t.jsx)("p",{className:"text-muted-foreground",children:"Loading prompts…"});let x=c.reduce((e,t)=>((e[t.category]=e[t.category]??[]).push(t),e),{}),g=l.length>=3&&l.length<=6,f=Math.ceil(15*l.length/60);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Pick 3–6 prompts. We’ll show them like a teleprompter while you record. (~",f," min total)"]}),(0,t.jsx)("div",{className:"space-y-4",children:Object.entries(x).map(([e,s])=>(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-foreground mb-2",children:e}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(e=>(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void a({selectedPromptIds:l.includes(t)?l.filter(e=>e!==t):l.length<6?[...l,t]:l})},className:(0,d.cn)("rounded-md border px-3 py-2 text-left text-sm transition-colors",l.includes(e.id)?"border-foreground bg-foreground text-background":"border-border hover:border-foreground/50"),children:e.text},e.id))})]},e))}),(0,t.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Selected: ",l.length," / ",6]}),(0,t.jsx)(o.Button,{type:"button",onClick:e,disabled:!g,children:"Next"})]})}y.displayName="Switch";var j=e.i(70065),C=e.i(46932),N=e.i(88653);function w({prompts:e,isRecording:r}){let[n,i]=(0,s.useState)(0);return((0,s.useEffect)(()=>{if(!r||0===e.length)return;let t=setTimeout(()=>{i(t=>(t+1)%e.length)},(12+6*Math.random())*1e3);return()=>clearTimeout(t)},[r,n,e.length]),0===e.length)?null:(0,t.jsx)("div",{className:"min-h-[4rem] flex items-center justify-center px-4",children:(0,t.jsx)(N.AnimatePresence,{mode:"wait",children:(0,t.jsx)(C.motion.p,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},exit:{opacity:0,y:-8},transition:{duration:.4},className:"text-center text-lg text-foreground max-w-lg",children:e[n]?.text},e[n]?.id??n)})})}function S({onComplete:e,promptSnapshots:r,guidedMode:n}){let i,[l,a]=(0,s.useState)(!1),[d,c]=(0,s.useState)(120),[u,m]=(0,s.useState)(null),p=(0,s.useRef)(null),h=(0,s.useRef)([]),x=(0,s.useRef)(null),g=(0,s.useCallback)(()=>{x.current&&clearInterval(x.current),x.current=null,a(!1),p.current?.state==="recording"&&p.current.stop()},[]),f=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:!0}),t=new MediaRecorder(e);h.current=[],t.ondataavailable=e=>e.data.size&&h.current.push(e.data),t.onstop=()=>{e.getTracks().forEach(e=>e.stop());let t=new Blob(h.current,{type:"audio/webm"});m(t)},p.current=t,t.start(),a(!0),c(120),x.current=setInterval(()=>{c(e=>e<=1?(g(),0):e-1)},1e3)}catch(e){console.error(e)}};return u?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Recording saved. You can go back to re-record or proceed."}),(0,t.jsx)(o.Button,{type:"button",onClick:()=>{m(null)},children:"Re-record"}),(0,t.jsx)(o.Button,{type:"button",onClick:()=>e(u),children:"Use this recording"})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[n&&r.length>0&&(0,t.jsx)(w,{prompts:r,isRecording:l}),(0,t.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,t.jsx)("span",{className:"text-2xl font-mono tabular-nums",children:(i=Math.floor(d/60),`${i}:${(d%60).toString().padStart(2,"0")}`)}),l?(0,t.jsx)(o.Button,{type:"button",variant:"destructive",onClick:g,children:"Stop"}):(0,t.jsx)(o.Button,{type:"button",onClick:f,children:"Start recording (max 2:00)"})]})]})}function k({onComplete:e,promptSnapshots:r,guidedMode:n}){let i,[l,a]=(0,s.useState)(!1),[d,c]=(0,s.useState)(90),[u,m]=(0,s.useState)(null),p=(0,s.useRef)(null),h=(0,s.useRef)(null),x=(0,s.useRef)(null),g=(0,s.useRef)([]),f=(0,s.useRef)(null),y=(0,s.useCallback)(()=>{f.current&&clearInterval(f.current),f.current=null,a(!1),h.current?.state==="recording"&&h.current.stop(),x.current?.getTracks().forEach(e=>e.stop())},[]),b=async()=>{try{let e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0});x.current=e,p.current&&(p.current.srcObject=e);let t=new MediaRecorder(e);g.current=[],t.ondataavailable=e=>e.data.size&&g.current.push(e.data),t.onstop=()=>{let e=new Blob(g.current,{type:"video/webm"});m(e)},h.current=t,t.start(),a(!0),c(90),f.current=setInterval(()=>{c(e=>e<=1?(y(),0):e-1)},1e3)}catch(e){console.error(e)}};return((0,s.useEffect)(()=>()=>{y()},[y]),u)?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Recording saved. You can go back to re-record or proceed."}),(0,t.jsx)(o.Button,{type:"button",onClick:()=>m(null),children:"Re-record"}),(0,t.jsx)(o.Button,{type:"button",onClick:()=>e(u),children:"Use this recording"})]}):(0,t.jsxs)("div",{className:"space-y-6",children:[n&&r.length>0&&(0,t.jsx)(w,{prompts:r,isRecording:l}),(0,t.jsxs)("div",{className:"relative rounded-lg overflow-hidden bg-muted aspect-video max-w-lg mx-auto",children:[(0,t.jsx)("video",{ref:p,autoPlay:!0,muted:!0,playsInline:!0,className:"w-full h-full object-cover"}),(0,t.jsx)("div",{className:"absolute bottom-2 left-2 font-mono text-white bg-black/70 px-2 py-1 rounded",children:(i=Math.floor(d/60),`${i}:${(d%60).toString().padStart(2,"0")}`)})]}),(0,t.jsx)("div",{className:"flex justify-center gap-2",children:l?(0,t.jsx)(o.Button,{type:"button",variant:"destructive",onClick:y,children:"Stop"}):(0,t.jsx)(o.Button,{type:"button",onClick:b,children:"Start recording (max 1:30)"})})]})}function M({onNext:e}){let r=(0,n.useComposeStore)(e=>e.messageType),o=(0,n.useComposeStore)(e=>e.textContent),a=(0,n.useComposeStore)(e=>e.guidedMode),d=(0,n.useComposeStore)(e=>e.selectedPromptIds)??[],c=(0,n.useComposeStore)(e=>e.setDraft),[u,m]=(0,s.useState)([]);return((0,s.useEffect)(()=>{0===d.length?m([]):(0,i.createClient)().from("prompts").select("id, text").in("id",d).then(({data:e})=>{m((e??[]).map(e=>({id:e.id,text:e.text})))})},[d]),"text"===r)?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"textContent",children:"Your message"}),(0,t.jsx)("textarea",{id:"textContent",className:"flex min-h-[200px] w-full rounded-md border border-border bg-transparent px-3 py-2 text-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring",placeholder:"Write anything you want your future self to read…",value:o??"",onChange:e=>c({textContent:e.target.value})})]}),o&&(0,t.jsx)(j.Card,{className:"bg-muted/50",children:(0,t.jsx)(j.CardContent,{className:"p-4",children:(0,t.jsx)("p",{className:"text-sm whitespace-pre-wrap",children:o})})}),(0,t.jsx)("button",{type:"button",className:"inline-flex items-center justify-center rounded-md text-sm font-medium h-10 px-4 bg-foreground text-background hover:bg-foreground/90",onClick:e,children:"Next"})]}):"audio"===r?(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(S,{promptSnapshots:u,guidedMode:a??!0,onComplete:t=>{c({mediaBlob:t}),e()}})}):"video"===r?(0,t.jsx)("div",{className:"space-y-6",children:(0,t.jsx)(k,{promptSnapshots:u,guidedMode:a??!0,onComplete:t=>{c({mediaBlob:t}),e()}})}):(0,t.jsx)("p",{className:"text-muted-foreground",children:"Select a message type in the previous step."})}function R({onNext:e}){let s=(0,n.useComposeStore)(e=>e.songTitle),r=(0,n.useComposeStore)(e=>e.songArtist),i=(0,n.useComposeStore)(e=>e.songUrl),d=(0,n.useComposeStore)(e=>e.setDraft);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"Optional: add a song that reminds you of this moment. We’ll store the link only (no playback in-app). Paste a Spotify or Apple Music URL."}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"songUrl",children:"Song URL"}),(0,t.jsx)(a.Input,{id:"songUrl",type:"url",placeholder:"https://open.spotify.com/track/… or https://music.apple.com/…",value:i??"",onChange:e=>{var t;d({songUrl:(t=e.target.value)||null}),d({songTitle:null,songArtist:null})}})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"songTitle",children:"Song title (optional)"}),(0,t.jsx)(a.Input,{id:"songTitle",value:s??"",onChange:e=>d({songTitle:e.target.value||null}),placeholder:"Title"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.Label,{htmlFor:"songArtist",children:"Artist (optional)"}),(0,t.jsx)(a.Input,{id:"songArtist",value:r??"",onChange:e=>d({songArtist:e.target.value||null}),placeholder:"Artist"})]})]}),(0,t.jsx)(o.Button,{type:"button",onClick:e,children:"Next"})]})}let I=["open.spotify.com","music.apple.com","spotify.com","apple.co"];function D({onSuccess:e}){let r=(0,n.useComposeStore)(e=>({deliverMode:e.deliverMode,deliverAt:e.deliverAt,birthdayDay:e.birthdayDay,birthdayMonth:e.birthdayMonth,timezone:e.timezone,messageType:e.messageType,textContent:e.textContent,selectedPromptIds:e.selectedPromptIds,guidedMode:e.guidedMode,songTitle:e.songTitle,songArtist:e.songArtist,songUrl:e.songUrl,mediaBlob:e.mediaBlob,editMessageId:e.editMessageId})),[l,a]=(0,s.useState)(!1),[d,c]=(0,s.useState)(null),u=(0,i.createClient)(),m="birthday"===r.deliverMode?r.birthdayDay&&r.birthdayMonth?`Your birthday (${r.birthdayMonth}/${r.birthdayDay})`:"Birthday (set month/day)":r.deliverAt?new Date(r.deliverAt).toLocaleString():"—",p=async()=>{var t;a(!0),c(null);let s="text"===r.messageType?null==(t=r.textContent)||""===t?"Message content is required for text type.":t.length>5e4?"Text must be under 50000 characters.":null:null,i=function(e){if(!e)return null;try{let t=new URL(e);if(!I.some(e=>t.hostname===e||t.hostname.endsWith(`.${e}`)))return"Please use a Spotify or Apple Music link."}catch{return"Invalid URL."}return null}(r.songUrl);if(s||i){c(s??i??null),a(!1);return}try{let t,s,{data:{user:i}}=await u.auth.getUser();if(!i){c("Not signed in"),a(!1);return}if("birthday"===r.deliverMode&&null!=r.birthdayDay&&null!=r.birthdayMonth){let e=new Date,s=e.getFullYear(),n=new Date(s,r.birthdayMonth-1,r.birthdayDay);n<=e&&(n=new Date(s+1,r.birthdayMonth-1,r.birthdayDay)),t=n.toISOString()}else if(r.deliverAt)t=new Date(r.deliverAt).toISOString();else{c("Set delivery date"),a(!1);return}let o=(r.selectedPromptIds??[]).map(e=>({id:e,text:""})),l={type:r.messageType??"text",text_content:"text"===r.messageType?r.textContent??null:null,deliver_at:t,deliver_mode:r.deliverMode??"date",birthday_day:r.birthdayDay??null,birthday_month:r.birthdayMonth??null,timezone:r.timezone??null,guided_mode:r.guidedMode??!0,selected_prompts:o,song_title:r.songTitle??null,song_artist:r.songArtist??null,song_url:r.songUrl??null};if(r.editMessageId){let{error:e}=await u.from("messages").update(l).eq("id",r.editMessageId).eq("user_id",i.id);if(e){c(e.message),a(!1);return}if(s=r.editMessageId,r.mediaBlob){let e=`${i.id}/${s}/media.webm`,{error:t}=await u.storage.from("capsule-media").upload(e,r.mediaBlob,{upsert:!0});t||await u.from("messages").update({media_path:e}).eq("id",s)}}else{let{data:e,error:t}=await u.from("messages").insert({user_id:i.id,...l,media_path:null,status:"scheduled"}).select("id").single();if(t){c(t.message),a(!1);return}if(s=e.id,r.mediaBlob){let e=`${i.id}/${s}/media.webm`,{error:t}=await u.storage.from("capsule-media").upload(e,r.mediaBlob,{upsert:!0});if(t){c(t.message),a(!1);return}await u.from("messages").update({media_path:e}).eq("id",s)}}n.useComposeStore.getState().reset(),e()}catch(e){c(e instanceof Error?e.message:"Something went wrong")}a(!1)};return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)(j.Card,{className:"bg-muted/50",children:(0,t.jsxs)(j.CardContent,{className:"p-4 space-y-2 text-sm",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Delivery:"})," ",m]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Type:"})," ",r.messageType??"—"]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Guided prompts:"})," ",(r.selectedPromptIds??[]).length]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Song link:"})," ",r.songUrl?"Yes":"No"]})]})}),d&&(0,t.jsx)("p",{className:"text-sm text-red-600",children:d}),(0,t.jsx)(o.Button,{onClick:p,disabled:l,children:l?"Saving…":"Confirm & save"})]})}let T=[{id:"delivery",title:"When to deliver"},{id:"type",title:"Message type"},{id:"guided",title:"Guided mode"},{id:"prompts",title:"Prompts"},{id:"content",title:"Your message"},{id:"song",title:"Nostalgia song"},{id:"review",title:"Review"}];function A(){let e=(0,r.useRouter)(),l=(0,r.useSearchParams)(),[a,d]=(0,s.useState)(0),c=(0,n.useComposeStore)(e=>e.setDraft);(0,s.useEffect)(()=>{let e=l.get("preset");e&&["1y","5y","10y","custom","birthday"].includes(e)&&c({preset:e});let t=l.get("edit");t&&(c({editMessageId:t}),(0,i.createClient)().from("messages").select("*").eq("id",t).single().then(({data:e})=>{e&&c({deliverMode:e.deliver_mode,deliverAt:e.deliver_at,birthdayDay:e.birthday_day,birthdayMonth:e.birthday_month,timezone:e.timezone??void 0,messageType:e.type,guidedMode:e.guided_mode,selectedPromptIds:(e.selected_prompts??[]).map(e=>e.id),textContent:e.text_content??void 0,mediaPath:e.media_path??null,songTitle:e.song_title??null,songArtist:e.song_artist??null,songUrl:e.song_url??null})}))},[l,c]);let u=T[a],p=a<T.length-1,h=a>0,x=()=>{p&&d(e=>e+1)};return(0,t.jsx)("div",{className:"container max-w-2xl py-8 px-4",children:(0,t.jsxs)(j.Card,{children:[(0,t.jsxs)(j.CardHeader,{className:"pb-2",children:[(0,t.jsxs)(j.CardTitle,{className:"text-lg",children:["Step ",a+1,": ",u.title]}),(0,t.jsx)("div",{className:"flex gap-1 mt-2",children:T.map((e,s)=>(0,t.jsx)("button",{type:"button",onClick:()=>d(s),className:`h-1.5 flex-1 rounded-full transition-colors ${s<=a?"bg-foreground":"bg-muted"}`,"aria-label":`Go to step ${s+1}`},e.id))})]}),(0,t.jsxs)(j.CardContent,{className:"space-y-6",children:["delivery"===u.id&&(0,t.jsx)(m,{onNext:x}),"type"===u.id&&(0,t.jsx)(f,{onNext:x}),"guided"===u.id&&(0,t.jsx)(b,{onNext:x}),"prompts"===u.id&&(0,t.jsx)(v,{onNext:x}),"content"===u.id&&(0,t.jsx)(M,{onNext:x}),"song"===u.id&&(0,t.jsx)(R,{onNext:x}),"review"===u.id&&(0,t.jsx)(D,{onSuccess:()=>e.push("/inbox")}),(0,t.jsxs)("div",{className:"flex justify-between pt-4",children:[(0,t.jsx)(o.Button,{type:"button",variant:"outline",onClick:()=>{h&&d(e=>e-1)},disabled:!h,children:"Back"}),"review"!==u.id&&(0,t.jsx)(o.Button,{type:"button",onClick:x,disabled:!p,children:"Next"})]})]})]})})}function B(){return(0,t.jsx)(A,{})}e.s(["default",()=>B],18304)}]);