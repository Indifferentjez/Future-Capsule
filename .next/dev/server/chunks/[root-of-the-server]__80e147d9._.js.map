{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/OneDrive/Desktop/Nostalgic%20Message%20to%20the%20future/lib/supabase/env.ts"],"sourcesContent":["/**\n * Supabase env validation. Throws a clear error listing missing vars.\n * Use one key: publishable (new) or anon (legacy).\n */\n\nconst URL = process.env.NEXT_PUBLIC_SUPABASE_URL;\nconst PUBLISHABLE = process.env.NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY;\nconst ANON = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY;\n\nexport const SUPABASE_URL = URL?.trim() || null;\nexport const SUPABASE_KEY = (PUBLISHABLE ?? ANON)?.trim() ?? null;\n\nexport function getSupabaseUrl(): string {\n  if (!SUPABASE_URL) {\n    const missing = [\"NEXT_PUBLIC_SUPABASE_URL\"];\n    throw new Error(\n      `Supabase URL is required. Missing env: ${missing.join(\", \")}. Set them in .env.local at project root.`\n    );\n  }\n  return SUPABASE_URL;\n}\n\nexport function getSupabaseKey(): string {\n  if (!SUPABASE_KEY) {\n    const missing = [\n      ...(PUBLISHABLE === undefined && ANON === undefined\n        ? [\"NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY\"]\n        : []),\n      ...(PUBLISHABLE === \"\" && ANON === \"\"\n        ? [\"NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY (empty)\"]\n        : []),\n    ];\n    if (missing.length === 0)\n      missing.push(\"NEXT_PUBLIC_SUPABASE_PUBLISHABLE_KEY or NEXT_PUBLIC_SUPABASE_ANON_KEY\");\n    throw new Error(\n      `Supabase key is required. Missing or empty env: ${missing.join(\", \")}. Set them in .env.local at project root.`\n    );\n  }\n  return SUPABASE_KEY;\n}\n\n/** Development-only: log whether URL/key are set (booleans only). */\nexport function logSupabaseEnvCheck(): void {\n  if (process.env.NODE_ENV !== \"development\") return;\n  // eslint-disable-next-line no-console\n  console.log(\"[Supabase env check]\", {\n    hasUrl: Boolean(SUPABASE_URL),\n    hasKey: Boolean(SUPABASE_KEY),\n  });\n}\n\nconst SERVICE_ROLE = process.env.SUPABASE_SERVICE_ROLE_KEY?.trim();\n\nexport function getSupabaseServiceRoleKey(): string {\n  if (!SERVICE_ROLE) {\n    throw new Error(\n      \"Supabase service role key is required. Missing env: SUPABASE_SERVICE_ROLE_KEY. Set it in .env.local at project root (server-side only).\"\n    );\n  }\n  return SERVICE_ROLE;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA;;;CAGC,GAED,MAAM;AACN,MAAM,cAAc,QAAQ,GAAG,CAAC,oCAAoC;AACpE,MAAM;AAEC,MAAM,eAAe,KAAK,UAAU;AACpC,MAAM,eAAe,CAAC,eAAe,IAAI,GAAG,UAAU;AAEtD,SAAS;IACd,IAAI,CAAC,cAAc;QACjB,MAAM,UAAU;YAAC;SAA2B;QAC5C,MAAM,IAAI,MACR,CAAC,uCAAuC,EAAE,QAAQ,IAAI,CAAC,MAAM,yCAAyC,CAAC;IAE3G;IACA,OAAO;AACT;AAEO,SAAS;IACd,IAAI,CAAC,cAAc;QACjB,MAAM,UAAU;eACV,sCACA,0BACA,EAAE;eACF,sCACA,0BACA,EAAE;SACP;QACD,IAAI,QAAQ,MAAM,KAAK,GACrB,QAAQ,IAAI,CAAC;QACf,MAAM,IAAI,MACR,CAAC,gDAAgD,EAAE,QAAQ,IAAI,CAAC,MAAM,yCAAyC,CAAC;IAEpH;IACA,OAAO;AACT;AAGO,SAAS;IACd;;IACA,sCAAsC;IACtC,QAAQ,GAAG,CAAC,wBAAwB;QAClC,QAAQ,QAAQ;QAChB,QAAQ,QAAQ;IAClB;AACF;AAEA,MAAM,eAAe,QAAQ,GAAG,CAAC,yBAAyB,EAAE;AAErD,SAAS;IACd,IAAI,CAAC,cAAc;QACjB,MAAM,IAAI,MACR;IAEJ;IACA,OAAO;AACT"}},
    {"offset": {"line": 108, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/OneDrive/Desktop/Nostalgic%20Message%20to%20the%20future/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\";\r\nimport { cookies } from \"next/headers\";\r\nimport { getSupabaseUrl, getSupabaseKey, logSupabaseEnvCheck } from \"./env\";\r\n\r\nexport async function createClient() {\r\n  logSupabaseEnvCheck();\r\n  const cookieStore = await cookies();\r\n  return createServerClient(getSupabaseUrl(), getSupabaseKey(), {\r\n    cookies: {\r\n      getAll() {\r\n        return cookieStore.getAll();\r\n      },\r\n      setAll(cookiesToSet) {\r\n        try {\r\n          cookiesToSet.forEach(({ name, value, options }) =>\r\n            cookieStore.set(name, value, options)\r\n          );\r\n        } catch {\r\n          // Server Component â€“ ignore\r\n        }\r\n      },\r\n    },\r\n  });\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AACA;;;;AAEO,eAAe;IACpB,IAAA,+IAAmB;IACnB,MAAM,cAAc,MAAM,IAAA,4IAAO;IACjC,OAAO,IAAA,iMAAkB,EAAC,IAAA,0IAAc,KAAI,IAAA,0IAAc,KAAI;QAC5D,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,4BAA4B;gBAC9B;YACF;QACF;IACF;AACF"}},
    {"offset": {"line": 141, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/OneDrive/Desktop/Nostalgic%20Message%20to%20the%20future/app/auth/callback/route.ts"],"sourcesContent":["import { createClient } from \"@/lib/supabase/server\";\nimport { NextResponse } from \"next/server\";\n\nconst DEBUG_ENDPOINT = \"http://127.0.0.1:7245/ingest/f8e7f2d9-6acb-412e-aa62-ecdc1a46b856\";\n\nfunction debugLog(data: { location: string; message: string; data?: Record<string, unknown>; hypothesisId?: string }) {\n  if (process.env.NODE_ENV !== \"development\") return;\n  fetch(DEBUG_ENDPOINT, {\n    method: \"POST\",\n    headers: { \"Content-Type\": \"application/json\" },\n    body: JSON.stringify({\n      ...data,\n      timestamp: Date.now(),\n      sessionId: \"debug-session\",\n    }),\n  }).catch(() => {});\n}\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url);\n  const code = searchParams.get(\"code\");\n\n  // #region agent log\n  debugLog({\n    location: \"auth/callback/route.ts\",\n    message: \"callback hit\",\n    data: { hasCode: !!code },\n    hypothesisId: \"H2-callback\",\n  });\n  // #endregion\n\n  if (!code) {\n    return NextResponse.redirect(new URL(\"/login?error=oauth_callback_failed\", request.url));\n  }\n\n  try {\n    const supabase = await createClient();\n    const { error } = await supabase.auth.exchangeCodeForSession(code);\n\n    // #region agent log\n    debugLog({\n      location: \"auth/callback/route.ts\",\n      message: \"exchange result\",\n      data: { error: error?.message ?? null },\n      hypothesisId: \"H2-callback\",\n    });\n    // #endregion\n\n    if (error) {\n      return NextResponse.redirect(new URL(\"/login?error=oauth_callback_failed\", request.url));\n    }\n    return NextResponse.redirect(new URL(\"/inbox\", request.url));\n  } catch (e) {\n    debugLog({\n      location: \"auth/callback/route.ts\",\n      message: \"exchange threw\",\n      data: { err: String((e as Error).message) },\n      hypothesisId: \"H2-callback\",\n    });\n    return NextResponse.redirect(new URL(\"/login?error=oauth_callback_failed\", request.url));\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAEA,MAAM,iBAAiB;AAEvB,SAAS,SAAS,IAAkG;IAClH;;IACA,MAAM,gBAAgB;QACpB,QAAQ;QACR,SAAS;YAAE,gBAAgB;QAAmB;QAC9C,MAAM,KAAK,SAAS,CAAC;YACnB,GAAG,IAAI;YACP,WAAW,KAAK,GAAG;YACnB,WAAW;QACb;IACF,GAAG,KAAK,CAAC,KAAO;AAClB;AAEO,eAAe,IAAI,OAAgB;IACxC,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;IAC5C,MAAM,OAAO,aAAa,GAAG,CAAC;IAE9B,oBAAoB;IACpB,SAAS;QACP,UAAU;QACV,SAAS;QACT,MAAM;YAAE,SAAS,CAAC,CAAC;QAAK;QACxB,cAAc;IAChB;IACA,aAAa;IAEb,IAAI,CAAC,MAAM;QACT,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sCAAsC,QAAQ,GAAG;IACxF;IAEA,IAAI;QACF,MAAM,WAAW,MAAM,IAAA,2IAAY;QACnC,MAAM,EAAE,KAAK,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,sBAAsB,CAAC;QAE7D,oBAAoB;QACpB,SAAS;YACP,UAAU;YACV,SAAS;YACT,MAAM;gBAAE,OAAO,OAAO,WAAW;YAAK;YACtC,cAAc;QAChB;QACA,aAAa;QAEb,IAAI,OAAO;YACT,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sCAAsC,QAAQ,GAAG;QACxF;QACA,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,UAAU,QAAQ,GAAG;IAC5D,EAAE,OAAO,GAAG;QACV,SAAS;YACP,UAAU;YACV,SAAS;YACT,MAAM;gBAAE,KAAK,OAAO,AAAC,EAAY,OAAO;YAAE;YAC1C,cAAc;QAChB;QACA,OAAO,gJAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sCAAsC,QAAQ,GAAG;IACxF;AACF"}}]
}