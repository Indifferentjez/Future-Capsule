module.exports=[54355,a=>{"use strict";a.s(["OpenCeremony",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call OpenCeremony() from the server but OpenCeremony is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/open/OpenCeremony.tsx <module evaluation>","OpenCeremony")},43550,a=>{"use strict";a.s(["OpenCeremony",()=>b]);let b=(0,a.i(11857).registerClientReference)(function(){throw Error("Attempted to call OpenCeremony() from the server but OpenCeremony is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/components/open/OpenCeremony.tsx","OpenCeremony")},92429,a=>{"use strict";a.i(54355);var b=a.i(43550);a.n(b)},74850,a=>{"use strict";var b=a.i(7997),c=a.i(39916),d=a.i(51615);let e=new TextEncoder,f=new TextDecoder,g=a=>{let b;return new Uint8Array(d.Buffer.from(((b=a)instanceof Uint8Array&&(b=f.decode(b)),b),"base64url"))};var h=a.i(66680),i=a.i(12057);class j extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(a,b){super(a,b),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class k extends j{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class l extends j{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(a,b,c="unspecified",d="unspecified"){super(a,{cause:{claim:c,reason:d,payload:b}}),this.claim=c,this.reason=d,this.payload=b}}class m extends j{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class n extends j{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class o extends j{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class p extends j{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class q extends j{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(a="multiple matching keys found in the JSON Web Key Set",b){super(a,b)}}class r extends j{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(a="signature verification failed",b){super(a,b)}}function s(a){switch(a){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new n(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}let t=h.webcrypto;function u(a,b,...c){if((c=c.filter(Boolean)).length>2){let b=c.pop();a+=`one of type ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of type ${c[0]} or ${c[1]}.`:a+=`of type ${c[0]}.`;return null==b?a+=` Received ${b}`:"function"==typeof b&&b.name?a+=` Received function ${b.name}`:"object"==typeof b&&null!=b&&b.constructor?.name&&(a+=` Received an instance of ${b.constructor.name}`),a}let v=(a,...b)=>u("Key must be ",a,...b);function w(a,b,...c){return u(`Key for the ${a} algorithm must be `,b,...c)}let x=a=>i.types.isKeyObject(a)||i.types.isCryptoKey(a),y=["KeyObject"];function z(a){if("object"!=typeof a||null===a||"[object Object]"!==Object.prototype.toString.call(a))return!1;if(null===Object.getPrototypeOf(a))return!0;let b=a;for(;null!==Object.getPrototypeOf(b);)b=Object.getPrototypeOf(b);return Object.getPrototypeOf(a)===b}function A(a){return z(a)&&"string"==typeof a.kty}(globalThis.CryptoKey||t?.CryptoKey)&&y.push("CryptoKey"),new WeakMap;let B=(a,b)=>{let c;try{c=a instanceof h.KeyObject?a.asymmetricKeyDetails?.modulusLength:Buffer.from(a.n,"base64url").byteLength<<3}catch{}if("number"!=typeof c||c<2048)throw TypeError(`${b} requires key modulusLength to be 2048 bits or larger`)},C=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function D(a,b){let c,d,e,f;if(b instanceof h.KeyObject)c=b.asymmetricKeyType,d=b.asymmetricKeyDetails;else switch(e=!0,b.kty){case"RSA":c="rsa";break;case"EC":c="ec";break;case"OKP":if("Ed25519"===b.crv){c="ed25519";break}if("Ed448"===b.crv){c="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(a){case"Ed25519":if("ed25519"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(c))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");B(b,a);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===c){let{hashAlgorithm:b,mgf1HashAlgorithm:c,saltLength:e}=d,f=parseInt(a.slice(-3),10);if(void 0!==b&&(b!==`sha${f}`||c!==b))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${a}`);if(void 0!==e&&e>f>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${a}`)}else if("rsa"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");B(b,a),f={padding:h.constants.RSA_PKCS1_PSS_PADDING,saltLength:h.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==c)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let d=((a,b)=>{let c;if(i.types.isCryptoKey(a))c=h.KeyObject.from(a);else if(i.types.isKeyObject(a))c=a;else if(A(a))return a.crv;else throw TypeError(v(a,...y));if("secret"===c.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(c.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${c.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${c.asymmetricKeyType.slice(1)}`;case"ec":{let a=c.asymmetricKeyDetails.namedCurve;switch(a){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new n("Unsupported key curve for this operation")}}default:throw TypeError("Invalid asymmetric key type for this operation")}})(b),e=C.get(a);if(d!==e)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${e}, got ${d}`);f={dsaEncoding:"ieee-p1363"};break}default:throw new n(`alg ${a} is not supported either by JOSE or your javascript runtime`)}return e?{format:"jwk",key:b,...f}:f?{...f,key:b}:b}function E(a,b="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${b} must be ${a}`)}function F(a,b){return a.name===b}function G(a){return parseInt(a.name.slice(4),10)}function H(a,b,c){if(b instanceof Uint8Array){if(!a.startsWith("HS"))throw TypeError(v(b,...y));return(0,h.createSecretKey)(b)}if(b instanceof h.KeyObject)return b;if(i.types.isCryptoKey(b))return!function(a,b,...c){switch(b){case"HS256":case"HS384":case"HS512":{if(!F(a.algorithm,"HMAC"))throw E("HMAC");let c=parseInt(b.slice(2),10);if(G(a.algorithm.hash)!==c)throw E(`SHA-${c}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!F(a.algorithm,"RSASSA-PKCS1-v1_5"))throw E("RSASSA-PKCS1-v1_5");let c=parseInt(b.slice(2),10);if(G(a.algorithm.hash)!==c)throw E(`SHA-${c}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!F(a.algorithm,"RSA-PSS"))throw E("RSA-PSS");let c=parseInt(b.slice(2),10);if(G(a.algorithm.hash)!==c)throw E(`SHA-${c}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==a.algorithm.name&&"Ed448"!==a.algorithm.name)throw E("Ed25519 or Ed448");break;case"Ed25519":if(!F(a.algorithm,"Ed25519"))throw E("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!F(a.algorithm,"ECDSA"))throw E("ECDSA");let c=function(a){switch(a){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(b);if(a.algorithm.namedCurve!==c)throw E(c,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(c.length&&!c.some(b=>a.usages.includes(b))){let a="CryptoKey does not support this operation, its usages must include ";if(c.length>2){let b=c.pop();a+=`one of ${c.join(", ")}, or ${b}.`}else 2===c.length?a+=`one of ${c[0]} or ${c[1]}.`:a+=`${c[0]}.`;throw TypeError(a)}}(b,a,c),h.KeyObject.from(b);if(A(b))return a.startsWith("HS")?(0,h.createSecretKey)(Buffer.from(b.k,"base64url")):b;throw TypeError(v(b,...y,"Uint8Array","JSON Web Key"))}let I=(0,i.promisify)(h.sign),J=async(a,b,c)=>{let d=H(a,b,"sign");if(a.startsWith("HS")){let b=h.createHmac(function(a){switch(a){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new n(`alg ${a} is not supported either by JOSE or your javascript runtime`)}}(a),d);return b.update(c),b.digest()}return I(s(a),c,D(a,d))},K=a=>a?.[Symbol.toStringTag],L=(a,b,c)=>{if(void 0!==b.use&&"sig"!==b.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==b.key_ops&&b.key_ops.includes?.(c)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${c}`);if(void 0!==b.alg&&b.alg!==a)throw TypeError(`Invalid key for this operation, when present its alg must be ${a}`);return!0};function M(a,b,c,d){b.startsWith("HS")||"dir"===b||b.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(b)?((a,b,c,d)=>{if(!(b instanceof Uint8Array)){if(d&&A(b)){if(A(b)&&"oct"===b.kty&&"string"==typeof b.k&&L(a,b,c))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!x(b))throw TypeError(w(a,b,...y,"Uint8Array",d?"JSON Web Key":null));if("secret"!==b.type)throw TypeError(`${K(b)} instances for symmetric algorithms must be of type "secret"`)}})(b,c,d,a):((a,b,c,d)=>{if(d&&A(b))switch(c){case"sign":if("oct"!==b.kty&&"string"==typeof b.d&&L(a,b,c))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if("oct"!==b.kty&&void 0===b.d&&L(a,b,c))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!x(b))throw TypeError(w(a,b,...y,d?"JSON Web Key":null));if("secret"===b.type)throw TypeError(`${K(b)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===c&&"public"===b.type)throw TypeError(`${K(b)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===c&&"public"===b.type)throw TypeError(`${K(b)} instances for asymmetric algorithm decryption must be of type "private"`);if(b.algorithm&&"verify"===c&&"private"===b.type)throw TypeError(`${K(b)} instances for asymmetric algorithm verifying must be of type "public"`);if(b.algorithm&&"encrypt"===c&&"private"===b.type)throw TypeError(`${K(b)} instances for asymmetric algorithm encryption must be of type "public"`)})(b,c,d,a)}M.bind(void 0,!1);let N=M.bind(void 0,!0),O=function(a,b,c,d,e){let f;if(void 0!==e.crit&&d?.crit===void 0)throw new a('"crit" (Critical) Header Parameter MUST be integrity protected');if(!d||void 0===d.crit)return new Set;if(!Array.isArray(d.crit)||0===d.crit.length||d.crit.some(a=>"string"!=typeof a||0===a.length))throw new a('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let g of(f=void 0!==c?new Map([...Object.entries(c),...b.entries()]):b,d.crit)){if(!f.has(g))throw new n(`Extension Header Parameter "${g}" is not recognized`);if(void 0===e[g])throw new a(`Extension Header Parameter "${g}" is missing`);if(f.get(g)&&void 0===d[g])throw new a(`Extension Header Parameter "${g}" MUST be integrity protected`)}return new Set(d.crit)},P=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,Q=a=>{let b,c=P.exec(a);if(!c||c[4]&&c[1])throw TypeError("Invalid time period format");let d=parseFloat(c[2]);switch(c[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":b=Math.round(d);break;case"minute":case"minutes":case"min":case"mins":case"m":b=Math.round(60*d);break;case"hour":case"hours":case"hr":case"hrs":case"h":b=Math.round(3600*d);break;case"day":case"days":case"d":b=Math.round(86400*d);break;case"week":case"weeks":case"w":b=Math.round(604800*d);break;default:b=Math.round(0x1e187e0*d)}return"-"===c[1]||"ago"===c[4]?-b:b},R=(0,i.promisify)(h.verify),S=async(a,b,c,d)=>{let e=H(a,b,"verify");if(a.startsWith("HS")){let b=await J(a,e,d);try{return h.timingSafeEqual(c,b)}catch{return!1}}let f=s(a),g=D(a,e);try{return await R(f,d,g,c)}catch{return!1}};async function T(a,b){if(!z(a))throw TypeError("JWK must be an object");switch(b||=a.alg,a.kty){case"oct":if("string"!=typeof a.k||!a.k)throw TypeError('missing "k" (Key Value) Parameter value');return g(a.k);case"RSA":if("oth"in a&&void 0!==a.oth)throw new n('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":var c;return(c={...a,alg:b}).d?(0,h.createPrivateKey)({format:"jwk",key:c}):(0,h.createPublicKey)({format:"jwk",key:c});default:throw new n('Unsupported "kty" (Key Type) Parameter value')}}async function U(a,b,c){let d,h;if(!z(a))throw new o("Flattened JWS must be an object");if(void 0===a.protected&&void 0===a.header)throw new o('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==a.protected&&"string"!=typeof a.protected)throw new o("JWS Protected Header incorrect type");if(void 0===a.payload)throw new o("JWS Payload missing");if("string"!=typeof a.signature)throw new o("JWS Signature missing or incorrect type");if(void 0!==a.header&&!z(a.header))throw new o("JWS Unprotected Header incorrect type");let i={};if(a.protected)try{let b=g(a.protected);i=JSON.parse(f.decode(b))}catch{throw new o("JWS Protected Header is invalid")}if(!((...a)=>{let b,c=a.filter(Boolean);if(0===c.length||1===c.length)return!0;for(let a of c){let c=Object.keys(a);if(!b||0===b.size){b=new Set(c);continue}for(let a of c){if(b.has(a))return!1;b.add(a)}}return!0})(i,a.header))throw new o("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let j={...i,...a.header},k=O(o,new Map([["b64",!0]]),c?.crit,i,j),l=!0;if(k.has("b64")&&"boolean"!=typeof(l=i.b64))throw new o('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:n}=j;if("string"!=typeof n||!n)throw new o('JWS "alg" (Algorithm) Header Parameter missing or invalid');let p=c&&((a,b)=>{if(void 0!==b&&(!Array.isArray(b)||b.some(a=>"string"!=typeof a)))throw TypeError(`"${a}" option must be an array of strings`);if(b)return new Set(b)})("algorithms",c.algorithms);if(p&&!p.has(n))throw new m('"alg" (Algorithm) Header Parameter value not allowed');if(l){if("string"!=typeof a.payload)throw new o("JWS Payload must be a string")}else if("string"!=typeof a.payload&&!(a.payload instanceof Uint8Array))throw new o("JWS Payload must be a string or an Uint8Array instance");let q=!1;"function"==typeof b?(b=await b(i,a),q=!0,N(n,b,"verify"),A(b)&&(b=await T(b,n))):N(n,b,"verify");let s=function(...a){let b=new Uint8Array(a.reduce((a,{length:b})=>a+b,0)),c=0;for(let d of a)b.set(d,c),c+=d.length;return b}(e.encode(a.protected??""),e.encode("."),"string"==typeof a.payload?e.encode(a.payload):a.payload);try{d=g(a.signature)}catch{throw new o("Failed to base64url decode the signature")}if(!await S(n,b,d,s))throw new r;if(l)try{h=g(a.payload)}catch{throw new o("Failed to base64url decode the payload")}else h="string"==typeof a.payload?e.encode(a.payload):a.payload;let t={payload:h};return(void 0!==a.protected&&(t.protectedHeader=i),void 0!==a.header&&(t.unprotectedHeader=a.header),q)?{...t,key:b}:t}async function V(a,b,c){if(a instanceof Uint8Array&&(a=f.decode(a)),"string"!=typeof a)throw new o("Compact JWS must be a string or Uint8Array");let{0:d,1:e,2:g,length:h}=a.split(".");if(3!==h)throw new o("Invalid Compact JWS");let i=await U({payload:e,protected:d,signature:g},b,c),j={payload:i.payload,protectedHeader:i.protectedHeader};return"function"==typeof b?{...j,key:i.key}:j}let W=a=>a.toLowerCase().replace(/^application\//,"");async function X(a,b,c){let d=await V(a,b,c);if(d.protectedHeader.crit?.includes("b64")&&!1===d.protectedHeader.b64)throw new p("JWTs MUST NOT use unencoded payload");let e={payload:((a,b,c={})=>{var d,e;let g,h;try{g=JSON.parse(f.decode(b))}catch{}if(!z(g))throw new p("JWT Claims Set must be a top-level JSON object");let{typ:i}=c;if(i&&("string"!=typeof a.typ||W(a.typ)!==W(i)))throw new k('unexpected "typ" JWT header value',g,"typ","check_failed");let{requiredClaims:j=[],issuer:m,subject:n,audience:o,maxTokenAge:q}=c,r=[...j];for(let a of(void 0!==q&&r.push("iat"),void 0!==o&&r.push("aud"),void 0!==n&&r.push("sub"),void 0!==m&&r.push("iss"),new Set(r.reverse())))if(!(a in g))throw new k(`missing required "${a}" claim`,g,a,"missing");if(m&&!(Array.isArray(m)?m:[m]).includes(g.iss))throw new k('unexpected "iss" claim value',g,"iss","check_failed");if(n&&g.sub!==n)throw new k('unexpected "sub" claim value',g,"sub","check_failed");if(o&&(d=g.aud,e="string"==typeof o?[o]:o,"string"==typeof d?!e.includes(d):!(Array.isArray(d)&&e.some(Set.prototype.has.bind(new Set(d))))))throw new k('unexpected "aud" claim value',g,"aud","check_failed");switch(typeof c.clockTolerance){case"string":h=Q(c.clockTolerance);break;case"number":h=c.clockTolerance;break;case"undefined":h=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:s}=c,t=Math.floor((s||new Date).getTime()/1e3);if((void 0!==g.iat||q)&&"number"!=typeof g.iat)throw new k('"iat" claim must be a number',g,"iat","invalid");if(void 0!==g.nbf){if("number"!=typeof g.nbf)throw new k('"nbf" claim must be a number',g,"nbf","invalid");if(g.nbf>t+h)throw new k('"nbf" claim timestamp check failed',g,"nbf","check_failed")}if(void 0!==g.exp){if("number"!=typeof g.exp)throw new k('"exp" claim must be a number',g,"exp","invalid");if(g.exp<=t-h)throw new l('"exp" claim timestamp check failed',g,"exp","check_failed")}if(q){let a=t-g.iat;if(a-h>("number"==typeof q?q:Q(q)))throw new l('"iat" claim timestamp check failed (too far in the past)',g,"iat","check_failed");if(a<0-h)throw new k('"iat" claim timestamp check failed (it should be in the past)',g,"iat","check_failed")}return g})(d.protectedHeader,d.payload,c),protectedHeader:d.protectedHeader};return"function"==typeof b?{...e,key:d.key}:e}let Y=process.env.CAPSULE_OPEN_SECRET??process.env.SUPABASE_SERVICE_ROLE_KEY??"";async function Z(a){try{let b=new TextEncoder().encode(Y),{payload:c}=await X(a,b),d=c.messageId,e=c.userId;if(!d||!e)return null;return{messageId:d,userId:e}}catch{return null}}a.i(70396);var $=a.i(73727),_=a.i(92429);async function aa({params:a,searchParams:d}){let{id:e}=await a,{token:f}=await d;f||(0,$.notFound)();let g=await Z(f);g&&g.messageId===e||(0,$.notFound)();let h=(0,c.createAdminClient)(),{data:i}=await h.from("messages").select("*").eq("id",e).eq("user_id",g.userId).single();i||(0,$.notFound)();let j=null;if(i.media_path){let{data:a}=await h.storage.from("capsule-media").createSignedUrl(i.media_path,3600);j=a?.signedUrl??null}return(0,b.jsx)(_.OpenCeremony,{message:{id:i.id,type:i.type,text_content:i.text_content,song_title:i.song_title,song_artist:i.song_artist,song_url:i.song_url,status:i.status},signedMediaUrl:j})}a.s(["default",()=>aa],74850)}];

//# sourceMappingURL=_08ce48b8._.js.map