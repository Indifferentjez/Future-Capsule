module.exports=[89761,e=>{"use strict";var t=e.i(47909),r=e.i(74017),s=e.i(96250),n=e.i(59756),i=e.i(61916),a=e.i(74677),o=e.i(69741),c=e.i(16795),d=e.i(87718),l=e.i(95169),u=e.i(47587),h=e.i(66012),p=e.i(70101),y=e.i(26937),f=e.i(10372),m=e.i(93695);e.i(52474);var g=e.i(5232),E=e.i(89171),w=e.i(79314),b=e.i(51615);let S=new TextEncoder,_=new TextDecoder,v=e=>b.Buffer.from(e).toString("base64url");var R=e.i(66680),T=e.i(12057);class A extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class P extends A{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class k extends A{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class O extends A{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class $ extends A{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}let H=R.webcrypto;function I(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let C=(e,...t)=>I("Key must be ",e,...t);function K(e,t,...r){return I(`Key for the ${e} algorithm must be `,t,...r)}let x=e=>T.types.isKeyObject(e)||T.types.isCryptoKey(e),N=["KeyObject"];function j(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function D(e){return j(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||H?.CryptoKey)&&N.push("CryptoKey"),new WeakMap;let U=(e,t)=>{let r;try{r=e instanceof R.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},M=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function J(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function W(e,t){return e.name===t}function q(e){return parseInt(e.name.slice(4),10)}let L=(0,T.promisify)(R.sign),B=async(e,t,r)=>{let s=function(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(C(t,...N));return(0,R.createSecretKey)(t)}if(t instanceof R.KeyObject)return t;if(T.types.isCryptoKey(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!W(e.algorithm,"HMAC"))throw J("HMAC");let r=parseInt(t.slice(2),10);if(q(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!W(e.algorithm,"RSASSA-PKCS1-v1_5"))throw J("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(q(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!W(e.algorithm,"RSA-PSS"))throw J("RSA-PSS");let r=parseInt(t.slice(2),10);if(q(e.algorithm.hash)!==r)throw J(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw J("Ed25519 or Ed448");break;case"Ed25519":if(!W(e.algorithm,"Ed25519"))throw J("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!W(e.algorithm,"ECDSA"))throw J("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw J(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}if(r.length&&!r.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(r.length>2){let t=r.pop();e+=`one of ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of ${r[0]} or ${r[1]}.`:e+=`${r[0]}.`;throw TypeError(e)}}(t,e,r),R.KeyObject.from(t);if(D(t))return e.startsWith("HS")?(0,R.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(C(t,...N,"Uint8Array","JSON Web Key"))}(e,t,"sign");if(e.startsWith("HS")){let t=R.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new P(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),s);return t.update(r),t.digest()}return L(function(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new P(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),r,function(e,t){let r,s,n,i;if(t instanceof R.KeyObject)r=t.asymmetricKeyType,s=t.asymmetricKeyDetails;else switch(n=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");U(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:n}=s,i=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${i}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==n&&n>i>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");U(t,e),i={padding:R.constants.RSA_PKCS1_PSS_PADDING,saltLength:R.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let s=((e,t)=>{let r;if(T.types.isCryptoKey(e))r=R.KeyObject.from(e);else if(T.types.isKeyObject(e))r=e;else if(D(e))return e.crv;else throw TypeError(C(e,...N));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new P("Unsupported key curve for this operation")}}default:throw TypeError("Invalid asymmetric key type for this operation")}})(t),n=M.get(e);if(s!==n)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${n}, got ${s}`);i={dsaEncoding:"ieee-p1363"};break}default:throw new P(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return n?{format:"jwk",key:t,...i}:i?{...i,key:t}:t}(e,s))},F=e=>e?.[Symbol.toStringTag],G=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0};function V(e,t,r,s){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?((e,t,r,s)=>{if(!(t instanceof Uint8Array)){if(s&&D(t)){if(D(t)&&"oct"===t.kty&&"string"==typeof t.k&&G(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!x(t))throw TypeError(K(e,t,...N,"Uint8Array",s?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${F(t)} instances for symmetric algorithms must be of type "secret"`)}})(t,r,s,e):((e,t,r,s)=>{if(s&&D(t))switch(r){case"sign":if("oct"!==t.kty&&"string"==typeof t.d&&G(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if("oct"!==t.kty&&void 0===t.d&&G(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!x(t))throw TypeError(K(e,t,...N,s?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${F(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${F(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${F(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${F(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${F(t)} instances for asymmetric algorithm encryption must be of type "public"`)})(t,r,s,e)}V.bind(void 0,!1);let Y=V.bind(void 0,!0),z=function(e,t,r,s,n){let i;if(void 0!==n.crit&&s?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!s||void 0===s.crit)return new Set;if(!Array.isArray(s.crit)||0===s.crit.length||s.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let a of(i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,s.crit)){if(!i.has(a))throw new P(`Extension Header Parameter "${a}" is not recognized`);if(void 0===n[a])throw new e(`Extension Header Parameter "${a}" is missing`);if(i.get(a)&&void 0===s[a])throw new e(`Extension Header Parameter "${a}" MUST be integrity protected`)}return new Set(s.crit)};class X{_payload;_protectedHeader;_unprotectedHeader;constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new k("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!((...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0})(this._protectedHeader,this._unprotectedHeader))throw new k("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...this._protectedHeader,...this._unprotectedHeader},n=z(k,new Map([["b64",!0]]),t?.crit,this._protectedHeader,s),i=!0;if(n.has("b64")&&"boolean"!=typeof(i=this._protectedHeader.b64))throw new k('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:a}=s;if("string"!=typeof a||!a)throw new k('JWS "alg" (Algorithm) Header Parameter missing or invalid');Y(a,e,"sign");let o=this._payload;i&&(o=S.encode(v(o)));let c=function(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let s of e)t.set(s,r),r+=s.length;return t}(r=this._protectedHeader?S.encode(v(JSON.stringify(this._protectedHeader))):S.encode(""),S.encode("."),o),d={signature:v(await B(a,e,c)),payload:""};return i&&(d.payload=_.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=_.decode(r)),d}}class Z{_flattened;constructor(e){this._flattened=new X(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}let Q=e=>Math.floor(e.getTime()/1e3),ee=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,et=e=>{let t,r=ee.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let s=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(s);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*s);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*s);break;case"day":case"days":case"d":t=Math.round(86400*s);break;case"week":case"weeks":case"w":t=Math.round(604800*s);break;default:t=Math.round(0x1e187e0*s)}return"-"===r[1]||"ago"===r[4]?-t:t};function er(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class es{_payload;constructor(e={}){if(!j(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:er("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:er("setNotBefore",Q(e))}:this._payload={...this._payload,nbf:Q(new Date)+et(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:er("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:er("setExpirationTime",Q(e))}:this._payload={...this._payload,exp:Q(new Date)+et(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:Q(new Date)}:e instanceof Date?this._payload={...this._payload,iat:er("setIssuedAt",Q(e))}:"string"==typeof e?this._payload={...this._payload,iat:er("setIssuedAt",Q(new Date)+et(e))}:this._payload={...this._payload,iat:er("setIssuedAt",e)},this}}(0,T.promisify)(R.verify);let en=process.env.CAPSULE_OPEN_SECRET??process.env.SUPABASE_SERVICE_ROLE_KEY??"";async function ei(e,t){let r=new TextEncoder().encode(en);return(class extends es{_protectedHeader;setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let r=new Z(S.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new O("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}})({messageId:e,userId:t}).setProtectedHeader({alg:"HS256"}).setExpirationTime("7d").sign(r)}var ea=Object.defineProperty,eo=Object.defineProperties,ec=Object.getOwnPropertyDescriptors,ed=Object.getOwnPropertySymbols,el=Object.prototype.hasOwnProperty,eu=Object.prototype.propertyIsEnumerable,eh=(e,t,r)=>t in e?ea(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,ep=(e,t)=>{for(var r in t||(t={}))el.call(t,r)&&eh(e,r,t[r]);if(ed)for(var r of ed(t))eu.call(t,r)&&eh(e,r,t[r]);return e},ey=(e,t,r)=>new Promise((s,n)=>{var i=e=>{try{o(r.next(e))}catch(e){n(e)}},a=e=>{try{o(r.throw(e))}catch(e){n(e)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(i,a);o((r=r.apply(e,t)).next())}),ef=class{constructor(e){this.resend=e}create(e){return ey(this,arguments,function*(e,t={}){return yield this.resend.post("/api-keys",e,t)})}list(){return ey(this,null,function*(){return yield this.resend.get("/api-keys")})}remove(e){return ey(this,null,function*(){return yield this.resend.delete(`/api-keys/${e}`)})}},em=class{constructor(e){this.resend=e}create(e){return ey(this,arguments,function*(e,t={}){return yield this.resend.post("/audiences",e,t)})}list(){return ey(this,null,function*(){return yield this.resend.get("/audiences")})}get(e){return ey(this,null,function*(){return yield this.resend.get(`/audiences/${e}`)})}remove(e){return ey(this,null,function*(){return yield this.resend.delete(`/audiences/${e}`)})}};function eg(e){var t;return{attachments:null==(t=e.attachments)?void 0:t.map(e=>({content:e.content,filename:e.filename,path:e.path,content_type:e.contentType,inline_content_id:e.inlineContentId})),bcc:e.bcc,cc:e.cc,from:e.from,headers:e.headers,html:e.html,reply_to:e.replyTo,scheduled_at:e.scheduledAt,subject:e.subject,tags:e.tags,text:e.text,to:e.to}}var eE=class{constructor(e){this.resend=e}send(e){return ey(this,arguments,function*(e,t={}){return this.create(e,t)})}create(t){return ey(this,arguments,function*(t,r={}){let s=[];for(let r of t){if(r.react){if(!this.renderAsync)try{let{renderAsync:t}=yield e.A(6693);this.renderAsync=t}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}r.html=yield this.renderAsync(r.react),r.react=void 0}s.push(eg(r))}return yield this.resend.post("/emails/batch",s,r)})}},ew=class{constructor(e){this.resend=e}create(t){return ey(this,arguments,function*(t,r={}){if(t.react){if(!this.renderAsync)try{let{renderAsync:t}=yield e.A(6693);this.renderAsync=t}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}t.html=yield this.renderAsync(t.react)}return yield this.resend.post("/broadcasts",{name:t.name,audience_id:t.audienceId,preview_text:t.previewText,from:t.from,html:t.html,reply_to:t.replyTo,subject:t.subject,text:t.text},r)})}send(e,t){return ey(this,null,function*(){return yield this.resend.post(`/broadcasts/${e}/send`,{scheduled_at:null==t?void 0:t.scheduledAt})})}list(){return ey(this,null,function*(){return yield this.resend.get("/broadcasts")})}get(e){return ey(this,null,function*(){return yield this.resend.get(`/broadcasts/${e}`)})}remove(e){return ey(this,null,function*(){return yield this.resend.delete(`/broadcasts/${e}`)})}update(e,t){return ey(this,null,function*(){return yield this.resend.patch(`/broadcasts/${e}`,{name:t.name,audience_id:t.audienceId,from:t.from,html:t.html,text:t.text,subject:t.subject,reply_to:t.replyTo,preview_text:t.previewText})})}},eb=class{constructor(e){this.resend=e}create(e){return ey(this,arguments,function*(e,t={}){return yield this.resend.post(`/audiences/${e.audienceId}/contacts`,{unsubscribed:e.unsubscribed,email:e.email,first_name:e.firstName,last_name:e.lastName},t)})}list(e){return ey(this,null,function*(){return yield this.resend.get(`/audiences/${e.audienceId}/contacts`)})}get(e){return ey(this,null,function*(){return e.id||e.email?yield this.resend.get(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}update(e){return ey(this,null,function*(){return e.id||e.email?yield this.resend.patch(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`,{unsubscribed:e.unsubscribed,first_name:e.firstName,last_name:e.lastName}):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}remove(e){return ey(this,null,function*(){return e.id||e.email?yield this.resend.delete(`/audiences/${e.audienceId}/contacts/${(null==e?void 0:e.email)?null==e?void 0:e.email:null==e?void 0:e.id}`):{data:null,error:{message:"Missing `id` or `email` field.",name:"missing_required_field"}}})}},eS=class{constructor(e){this.resend=e}create(e){return ey(this,arguments,function*(e,t={}){return yield this.resend.post("/domains",{name:e.name,region:e.region,custom_return_path:e.customReturnPath},t)})}list(){return ey(this,null,function*(){return yield this.resend.get("/domains")})}get(e){return ey(this,null,function*(){return yield this.resend.get(`/domains/${e}`)})}update(e){return ey(this,null,function*(){return yield this.resend.patch(`/domains/${e.id}`,{click_tracking:e.clickTracking,open_tracking:e.openTracking,tls:e.tls})})}remove(e){return ey(this,null,function*(){return yield this.resend.delete(`/domains/${e}`)})}verify(e){return ey(this,null,function*(){return yield this.resend.post(`/domains/${e}/verify`)})}},e_=class{constructor(e){this.resend=e}send(e){return ey(this,arguments,function*(e,t={}){return this.create(e,t)})}create(t){return ey(this,arguments,function*(t,r={}){if(t.react){if(!this.renderAsync)try{let{renderAsync:t}=yield e.A(6693);this.renderAsync=t}catch(e){throw Error("Failed to render React component. Make sure to install `@react-email/render`")}t.html=yield this.renderAsync(t.react)}return yield this.resend.post("/emails",eg(t),r)})}get(e){return ey(this,null,function*(){return yield this.resend.get(`/emails/${e}`)})}update(e){return ey(this,null,function*(){return yield this.resend.patch(`/emails/${e.id}`,{scheduled_at:e.scheduledAt})})}cancel(e){return ey(this,null,function*(){return yield this.resend.post(`/emails/${e}/cancel`)})}},ev="u">typeof process&&process.env&&process.env.RESEND_BASE_URL||"https://api.resend.com",eR="u">typeof process&&process.env&&process.env.RESEND_USER_AGENT||"resend-node:4.8.0",eT=class{constructor(e){if(this.key=e,this.apiKeys=new ef(this),this.audiences=new em(this),this.batch=new eE(this),this.broadcasts=new ew(this),this.contacts=new eb(this),this.domains=new eS(this),this.emails=new e_(this),!e&&("u">typeof process&&process.env&&(this.key=process.env.RESEND_API_KEY),!this.key))throw Error('Missing API key. Pass it to the constructor `new Resend("re_123")`');this.headers=new Headers({Authorization:`Bearer ${this.key}`,"User-Agent":eR,"Content-Type":"application/json"})}fetchRequest(e){return ey(this,arguments,function*(e,t={}){try{let r=yield fetch(`${ev}${e}`,t);if(!r.ok)try{let e=yield r.text();return{data:null,error:JSON.parse(e)}}catch(t){if(t instanceof SyntaxError)return{data:null,error:{name:"application_error",message:"Internal server error. We are unable to process your request right now, please try again later."}};let e={message:r.statusText,name:"application_error"};if(t instanceof Error){let r,s;return{data:null,error:(r=ep({},e),s={message:t.message},eo(r,ec(s)))}}return{data:null,error:e}}return{data:yield r.json(),error:null}}catch(e){return{data:null,error:{name:"application_error",message:"Unable to fetch data. The request could not be resolved."}}}})}post(e,t){return ey(this,arguments,function*(e,t,r={}){let s=new Headers(this.headers);r.idempotencyKey&&s.set("Idempotency-Key",r.idempotencyKey);let n=ep({method:"POST",headers:s,body:JSON.stringify(t)},r);return this.fetchRequest(e,n)})}get(e){return ey(this,arguments,function*(e,t={}){let r=ep({method:"GET",headers:this.headers},t);return this.fetchRequest(e,r)})}put(e,t){return ey(this,arguments,function*(e,t,r={}){let s=ep({method:"PUT",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,s)})}patch(e,t){return ey(this,arguments,function*(e,t,r={}){let s=ep({method:"PATCH",headers:this.headers,body:JSON.stringify(t)},r);return this.fetchRequest(e,s)})}delete(e,t){return ey(this,null,function*(){let r={method:"DELETE",headers:this.headers,body:JSON.stringify(t)};return this.fetchRequest(e,r)})}};let eA=process.env.RESEND_API_KEY?new eT(process.env.RESEND_API_KEY):null;async function eP(t){try{let{createAdminClient:r}=await e.A(88549),s=r(),{data:n}=await s.auth.admin.getUserById(t);return n?.user?.email??null}catch{return null}}let ek=async(e,t)=>{let r=e.includes("@")?e:await eP(e);if(r){if(!eA)return void console.warn("Resend not configured. Would send to",r,"link:",t);await eA.emails.send({from:process.env.RESEND_FROM??"Time Capsule <onboarding@resend.dev>",to:[r],subject:"A message from your past self has arrived",html:`
      <p>Your future self time capsule is ready to open.</p>
      <p><a href="${t}">Open your message</a></p>
      <p>This link expires in 7 days.</p>
    `})}};async function eO(){let e=(0,w.createAdminClient)(),{data:t}=await e.from("messages").select("id, user_id").eq("status","scheduled").lte("deliver_at",new Date().toISOString()),r=0;for(let s of t??[]){await e.from("messages").update({status:"delivered"}).eq("id",s.id);let t=await ei(s.id,s.user_id),n=`http://localhost:3000/open/${s.id}?token=${t}`;await ek(s.user_id,n),r++}return{delivered:r}}async function e$(e){let t=e.headers.get("authorization"),r=process.env.CRON_SECRET;if(r&&t!==`Bearer ${r}`)return E.NextResponse.json({error:"Unauthorized"},{status:401});let{delivered:s}=await eO();return E.NextResponse.json({delivered:s})}e.s(["GET",()=>e$,"dynamic",0,"force-dynamic","maxDuration",0,60],60092);var eH=e.i(60092);let eI=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/cron/deliver/route",pathname:"/api/cron/deliver",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/app/api/cron/deliver/route.ts",nextConfigOutput:"",userland:eH}),{workAsyncStorage:eC,workUnitAsyncStorage:eK,serverHooks:ex}=eI;function eN(){return(0,s.patchFetch)({workAsyncStorage:eC,workUnitAsyncStorage:eK})}async function ej(e,t,s){eI.isDev&&(0,n.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let E="/api/cron/deliver/route";E=E.replace(/\/index$/,"")||"/";let w=await eI.prepare(e,t,{srcPage:E,multiZoneDraftMode:!1});if(!w)return t.statusCode=400,t.end("Bad Request"),null==s.waitUntil||s.waitUntil.call(s,Promise.resolve()),null;let{buildId:b,params:S,nextConfig:_,parsedUrl:v,isDraftMode:R,prerenderManifest:T,routerServerContext:A,isOnDemandRevalidate:P,revalidateOnlyGenerated:k,resolvedPathname:O,clientReferenceManifest:$,serverActionsManifest:H}=w,I=(0,o.normalizeAppPath)(E),C=!!(T.dynamicRoutes[I]||T.routes[O]),K=async()=>((null==A?void 0:A.render404)?await A.render404(e,t,v,!1):t.end("This page could not be found"),null);if(C&&!R){let e=!!T.routes[O],t=T.dynamicRoutes[I];if(t&&!1===t.fallback&&!e){if(_.experimental.adapterPath)return await K();throw new m.NoFallbackError}}let x=null;!C||eI.isDev||R||(x="/index"===(x=O)?"/":x);let N=!0===eI.isDev||!C,j=C&&!N;H&&$&&(0,a.setManifestsSingleton)({page:E,clientReferenceManifest:$,serverActionsManifest:H});let D=e.method||"GET",U=(0,i.getTracer)(),M=U.getActiveScopeSpan(),J={params:S,prerenderManifest:T,renderOpts:{experimental:{authInterrupts:!!_.experimental.authInterrupts},cacheComponents:!!_.cacheComponents,supportsDynamicResponse:N,incrementalCache:(0,n.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:_.cacheLife,waitUntil:s.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,s,n)=>eI.onRequestError(e,t,s,n,A)},sharedContext:{buildId:b}},W=new c.NodeNextRequest(e),q=new c.NodeNextResponse(t),L=d.NextRequestAdapter.fromNodeNextRequest(W,(0,d.signalFromNodeResponse)(t));try{let a=async e=>eI.handle(L,J).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=U.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==l.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let s=r.get("next.route");if(s){let t=`${D} ${s}`;e.setAttributes({"next.route":s,"http.route":s,"next.span_name":t}),e.updateName(t)}else e.updateName(`${D} ${E}`)}),o=!!(0,n.getRequestMeta)(e,"minimalMode"),c=async n=>{var i,c;let d=async({previousCacheEntry:r})=>{try{if(!o&&P&&k&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await a(n);e.fetchMetrics=J.renderOpts.fetchMetrics;let c=J.renderOpts.pendingWaitUntil;c&&s.waitUntil&&(s.waitUntil(c),c=void 0);let d=J.renderOpts.collectedTags;if(!C)return await (0,h.sendResponse)(W,q,i,J.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,p.toNodeOutgoingHttpHeaders)(i.headers);d&&(t[f.NEXT_CACHE_TAGS_HEADER]=d),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==J.renderOpts.collectedRevalidate&&!(J.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&J.renderOpts.collectedRevalidate,s=void 0===J.renderOpts.collectedExpire||J.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:J.renderOpts.collectedExpire;return{value:{kind:g.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:s}}}}catch(t){throw(null==r?void 0:r.isStale)&&await eI.onRequestError(e,t,{routerKind:"App Router",routePath:E,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},!1,A),t}},l=await eI.handleResponse({req:e,nextConfig:_,cacheKey:x,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:T,isRoutePPREnabled:!1,isOnDemandRevalidate:P,revalidateOnlyGenerated:k,responseGenerator:d,waitUntil:s.waitUntil,isMinimalMode:o});if(!C)return null;if((null==l||null==(i=l.value)?void 0:i.kind)!==g.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==l||null==(c=l.value)?void 0:c.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",P?"REVALIDATED":l.isMiss?"MISS":l.isStale?"STALE":"HIT"),R&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let m=(0,p.fromNodeOutgoingHttpHeaders)(l.value.headers);return o&&C||m.delete(f.NEXT_CACHE_TAGS_HEADER),!l.cacheControl||t.getHeader("Cache-Control")||m.get("Cache-Control")||m.set("Cache-Control",(0,y.getCacheControlHeader)(l.cacheControl)),await (0,h.sendResponse)(W,q,new Response(l.value.body,{headers:m,status:l.value.status||200})),null};M?await c(M):await U.withPropagatedContext(e.headers,()=>U.trace(l.BaseServerSpan.handleRequest,{spanName:`${D} ${E}`,kind:i.SpanKind.SERVER,attributes:{"http.method":D,"http.target":e.url}},c))}catch(t){if(t instanceof m.NoFallbackError||await eI.onRequestError(e,t,{routerKind:"App Router",routePath:I,routeType:"route",revalidateReason:(0,u.getRevalidateReason)({isStaticGeneration:j,isOnDemandRevalidate:P})},!1,A),C)throw t;return await (0,h.sendResponse)(W,q,new Response(null,{status:500})),null}}e.s(["handler",()=>ej,"patchFetch",()=>eN,"routeModule",()=>eI,"serverHooks",()=>ex,"workAsyncStorage",()=>eC,"workUnitAsyncStorage",()=>eK],89761)}];

//# sourceMappingURL=node_modules_next_dist_esm_build_templates_app-route_d3cbce84.js.map